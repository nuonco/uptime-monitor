# =============================================================================
# NUON DEPROVISION ROLE
# =============================================================================
#
# IAM role used when tearing down an install. This role is assumed by the Nuon
# runner when deleting components and destroying the sandbox infrastructure.
#
# Schema: https://api.nuon.co/v1/general/config-schema?type=permissions
#
# =============================================================================


type                 = "deprovision"
name                 = "{{ .nuon.install.id }}-deprovision"
description          = "{{ .nuon.install.id }} deprovision role for the Uptime install"
display_name         = "{{ .nuon.install.id }}-deprovision"
permissions_boundary = "./deprovision_boundary.json"


# -----------------------------------------------------------------------------
# POLICIES
# -----------------------------------------------------------------------------

# AWS managed policy (broad access for demo purposes)
[[policies]]
managed_policy_name = "AdministratorAccess"

# Alternative: Scoped policy for production (delete-focused)
# [[policies]]
# name = "{{.nuon.install.id}}-deprovision-policy"
# contents = """
# {
#   "Version": "2012-10-17",
#   "Statement": [
#     {
#       "Effect": "Allow",
#       "Action": ["eks:DeleteCluster", "eks:DeleteNodegroup", "eks:Describe*"],
#       "Resource": "*"
#     },
#     {
#       "Effect": "Allow",
#       "Action": ["s3:DeleteBucket", "s3:DeleteObject", "s3:ListBucket"],
#       "Resource": "arn:aws:s3:::{{.nuon.install.id}}-*"
#     },
#     {
#       "Effect": "Allow",
#       "Action": ["rds:DeleteDBInstance", "rds:Describe*"],
#       "Resource": "*"
#     }
#   ]
# }
# """
